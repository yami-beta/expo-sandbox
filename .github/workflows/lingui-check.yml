name: Lingui Check

on:
  push:
    branches:
      - main
    paths:
      - 'apps/sandbox/src/**/*.tsx'
      - 'apps/sandbox/src/**/*.ts'
      - 'apps/sandbox/src/**/*.po'
  pull_request:
    paths:
      - 'apps/sandbox/src/**/*.tsx'
      - 'apps/sandbox/src/**/*.ts'
      - 'apps/sandbox/src/**/*.po'

jobs:
  lingui-check:
    name: Lingui Extract Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js and pnpm
        uses: ./.github/actions/setup-node

      - name: Run lingui extract
        run: pnpm -C apps/sandbox lingui:extract

      - name: Check for uncommitted changes
        run: |
          if [[ -n $(git status --porcelain) ]]; then
            echo "::error::Lingui extract produced changes. Translation files are not up to date."
            echo ""
            echo "### ‚ùå Translation files are out of sync"
            echo ""
            echo "Please run the following command and commit the changes:"
            echo "\`\`\`bash"
            echo "pnpm -C apps/sandbox lingui:extract"
            echo "\`\`\`"
            echo ""
            echo "### üìù Changed files:"
            echo "\`\`\`"
            git status --porcelain
            echo "\`\`\`"
            echo ""
            echo "### üîç Detailed changes:"
            echo "\`\`\`diff"
            git diff --color=never
            echo "\`\`\`"
            exit 1
          else
            echo "‚úÖ All translation files are up to date"
          fi
